<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>meow</title>
</head>
<body>
  <nav>
    <button id="show-login">Login</button>
    <button id="show-signup">Sign Up</button>
  </nav>

  <!-- Login Form -->
  <section id="login-section" hidden>
    <h2>Login</h2>
    <form id="login-form">
      <input name="email" type="email" placeholder="Email" required />
      <input name="password" type="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
    <pre id="login-result"></pre>
  </section>


  <h1>meow</h1>

  <!-- 1) Add a Charity -->
  <section>
    <h2>1) Add a Charity</h2>
    <form id="charity-form">
      <input name="name" placeholder="Charity Name" required />
      <input name="stripe_account_id" placeholder="Stripe Account ID" required />
      <button type="submit">Add Charity</button>
    </form>
    <pre id="charity-result"></pre>
  </section>

  <section id="signup-section">
    <h2>Sign Up</h2>
    <form id="signup-form">
      <input name="email" type="email" placeholder="Email" required />
      <input name="password" type="password" placeholder="Password" required />
      <input name="nickname" type="text" placeholder="Nickname" required />
      <button type="submit">Sign Up</button>
    </form>
    <pre id="signup-result"></pre>
  </section>

  <!-- 3) Add a Routine -->
  <section>
    <h2>3) Add a Routine</h2>
    <form id="routine-form">
      <input name="user_id" placeholder="User ID" required />
      <input name="description" placeholder="Routine Description" required />
      <input name="frequency" placeholder="Frequency (e.g. daily)" required />
      <input name="charity_id" placeholder="Charity ID" required />
      <input name="donation_amount" type="number" placeholder="Donation Amount (cents)" required />
      <button type="submit">Add Routine</button>
    </form>
    <pre id="routine-result"></pre>
  </section>

  <!-- 4) Report a Completed Routine -->
  <section>
    <h2>4) Report Routine</h2>
    <form id="report-form">
      <input name="routine_id" placeholder="Routine ID" required />
      <label>
        <input name="did_task" type="checkbox" />
        I did this routine
      </label>
      <button type="submit">Submit Report</button>
    </form>
    <pre id="report-result"></pre>
  </section>

  <script>
    async function postJSON(url, data, resultEl) {
      try {
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const json = await res.json();
        resultEl.textContent = JSON.stringify(json, null, 2);
      } catch (err) {
        resultEl.textContent = `Error: ${err.message}`;
      }
    }
  
    document.addEventListener("DOMContentLoaded", () => {
      // auth togglesâ€¦
      document.getElementById("show-login").onclick = () => {
        document.getElementById("login-section").hidden = false;
        document.getElementById("signup-section").hidden = true;
      };
      document.getElementById("show-signup").onclick = () => {
        document.getElementById("signup-section").hidden = false;
        document.getElementById("login-section").hidden = true;
      };
  
      // login
      const loginForm = document.getElementById("login-form");
      loginForm?.addEventListener("submit", e => {
        e.preventDefault();
        const f = e.target;
        postJSON("/login", {
          email: f.email.value,
          password: f.password.value
        }, document.getElementById("login-result"));
      });
  
      // signup
      const signupForm = document.getElementById("signup-form");
      signupForm?.addEventListener("submit", e => {
        e.preventDefault();
        const f = e.target;
        postJSON("/register", {
          email:    f.email.value,
          password: f.password.value,
          nickname: f.nickname.value
        }, document.getElementById("signup-result"));
      });
  
      // charity
      const charityForm = document.getElementById("charity-form");
      charityForm?.addEventListener("submit", e => {
        e.preventDefault();
        const f = e.target;
        postJSON("/charity", {
          name:               f.name.value,
          stripe_account_id:  f.stripe_account_id.value
        }, document.getElementById("charity-result"));
      });
  
      // **routine**
      const routineForm = document.getElementById("routine-form");
      routineForm?.addEventListener("submit", e => {
        e.preventDefault();
        const f = e.target;
        postJSON("/routine", {
          user_id:         f.user_id.value,
          description:     f.description.value,
          frequency:       f.frequency.value,
          charity_id:      f.charity_id.value,
          donation_amount: Number(f.donation_amount.value)
        }, document.getElementById("routine-result"));
      });
  
      // report
      const reportForm = document.getElementById("report-form");
      reportForm?.addEventListener("submit", e => {
        e.preventDefault();
        const f = e.target;
        postJSON("/report-task", {
          routine_id: f.routine_id.value,
          did_task:   f.did_task.checked
        }, document.getElementById("report-result"));
      });
    });
  </script>
  
</body>
</html>
